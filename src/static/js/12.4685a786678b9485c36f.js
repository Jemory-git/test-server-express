webpackJsonp([12],{FkIM:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("BO1k"),s=a.n(r),i=a("Gu7T"),o=a.n(i),n=a("uXZL"),l=a.n(n),c=a("PJh5"),m=a.n(c),d={data:function(){return{searchForm:{storeId:null,storename:"",startTime:null,endTime:null},storeList:[],allStore:[{name:"全部",id:""}],firstResult:[],arrResult:[],colunmDate:[],colunmList:[],page:{currentPage:0,pageCount:0,pageSize:0,total:0},pickerOptions:{disabledDate:function(e){return e.getTime()>=Date.now()-864e5}},loading2:!1}},created:function(){this.getOrders(),this.getStore()},activated:function(){this.getOrders({page:this.page.currentPage})},methods:{getStore:function(){var e=this,t=this.$route.query.brandId;this.$route.query.brandId?this.$axios.get("/seller/storeList/"+t).then(function(t){0==t.data.code?e.storeList=[].concat(o()(e.allStore),o()(t.data.data)):e.$message({message:t.data.msg,type:"error"})}):this.storeList=[].concat(o()(this.allStore))},selectStore:function(e){var t;t=this.storeList.find(function(t){return t.id===e}),this.searchForm.storeId=t.id},resetSearchForm:function(){this.$refs.searchFormRef.resetFields(),this.isSearch=!1,this.getOrders()},searchOrders:function(){if(""==this.searchForm.startTime&&(this.searchForm.startTime=null),""==this.searchForm.endTime&&(this.searchForm.endTime=null),""==this.searchForm.storeId&&(this.searchForm.storeId=null),this.searchForm.startTime&&this.searchForm.endTime){var e=new Date(Date.parse(this.searchForm.startTime.replace(/-/g,"/"))),t=new Date(Date.parse(this.searchForm.endTime.replace(/-/g,"/")));if(parseInt((t.getTime()-e.getTime())/864e5)>30)return void this.$message({message:"日期范围应在一个月之内",type:"warning"});if(e.getTime()>t.getTime())return void this.$message({message:"日期范围不正确",type:"warning"})}this.isSearch=null!=this.searchForm.storeId||null!=this.searchForm.startTime||null!=this.searchForm.endTime,this.getOrders()},changePage:function(e){var t={page:e};this.getOrders(t)},getOrders:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{page:1,size:10};this.isSearch&&(t.startTime=this.searchForm.startTime,t.endTime=this.searchForm.endTime,t.storeId=this.searchForm.storeId),null==t.size&&(t.size=10),null==t.page&&(t.page=1),this.$axios.get("/seller/couponTimeList",{params:t}).then(function(t){if(0==t.data.code){e.arrResult=[],e.colunmDate=[],e.arrResult=t.data.data,e.firstResult=t.data.data[0].page.list;var a=!0,r=!1,i=void 0;try{for(var o,n=s()(e.arrResult);!(a=(o=n.next()).done);a=!0){var l=o.value;e.colunmDate.push(l.date)}}catch(e){r=!0,i=e}finally{try{!a&&n.return&&n.return()}finally{if(r)throw i}}0!=t.data.data.length&&(e.page={pageCount:t.data.data[0].page.totalPage,currentPage:t.data.data[0].page.currPage,pageSize:t.data.data[0].page.pageSize,total:t.data.data[0].page.totalCount})}else e.$message({message:t.data.msg,type:"error"})})},exportExcel:function(){var e=this;this.loading2=!0;var t={page:1,size:99999999};t.startTime=this.searchForm.startTime,t.endTime=this.searchForm.endTime,t.storeId=this.searchForm.storeId,this.$axios.get("/seller/couponTimeList",{params:t}).then(function(t){0==t.data.code?e._exportExcel(t.data.data):e.$message({message:t.data.msg,type:"error"})})},_exportExcel:function(e){this.loading2=!1;var t=["优惠券名称"];e.forEach(function(e){t.push(e.date)});var a=[t],r=0;e[0].page.list.forEach(function(t){var s=[t.couponName];e.map(function(e){s.push(e.page.list[r].num)}),r++,a=a.concat([s])});for(var s=a,i=l.a.utils.aoa_to_sheet(s),o=[{wpx:150}],n=1;n<e.length+1;n++)o.push({wpx:90});i["!cols"]=o;var c=l.a.utils.book_new();l.a.utils.book_append_sheet(c,i),l.a.writeFile(c,"门店-核销笔数-"+m()(new Date).format("YYYYMMDD")+".xlsx")}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading2,expression:"loading2"}],attrs:{"element-loading-text":"下载中,请稍等...","element-loading-background":"rgba(245, 245, 245, 0.5)"}},[a("el-form",{ref:"searchFormRef",attrs:{inline:"",model:e.searchForm}},[a("el-form-item",{attrs:{label:"交易开始时间",prop:"startTime"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{clearable:"","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.searchForm.startTime,callback:function(t){e.$set(e.searchForm,"startTime",t)},expression:"searchForm.startTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"交易结束时间",prop:"endTime"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{clearable:"","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.searchForm.endTime,callback:function(t){e.$set(e.searchForm,"endTime",t)},expression:"searchForm.endTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店",prop:"shop"}},[a("el-select",{attrs:{placeholder:"全部"},on:{change:e.selectStore},model:{value:e.searchForm.storename,callback:function(t){e.$set(e.searchForm,"storename",t)},expression:"searchForm.storename"}},e._l(e.storeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchOrders}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:e.resetSearchForm}},[e._v("重置")]),e._v(" "),a("el-button",{on:{click:e.exportExcel}},[e._v("导出Excel")])],1)],1),e._v(" "),a("el-table",{attrs:{stripe:"",data:e.firstResult}},[a("el-table-column",{attrs:{prop:"couponName",label:"优惠券名称",width:"140px"}}),e._v(" "),e._l(e.colunmDate,function(t,r){return a("el-table-column",{key:r,attrs:{label:t,width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.arrResult[r].page.list[t.$index].num))])]}}])})})],2),e._v(" "),a("div",{staticClass:"pagination-div"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-count":e.page.pageCount,currentPage:e.page.currentPage,pageSize:e.page.pageSize,total:e.page.total},on:{"current-change":e.changePage}})],1)],1)},staticRenderFns:[]};var h=a("VU/8")(d,u,!1,function(e){a("LIbH")},"data-v-0ec74f28",null);t.default=h.exports},LIbH:function(e,t){}});