webpackJsonp([8],{BUaM:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("uXZL"),n=a.n(r),o=a("PJh5"),l=a.n(o),s={name:"coupon-record",data:function(){return{isSearch:!1,searchForm:{startTime:null,endTime:null},orderList:[],data_total:[],page:{currentPage:0,pageCount:0,pageSize:0,total:0},options:{brands:[],states:[{value:1,name:"待使用"},{value:2,name:"已使用"},{value:4,name:"已过期"},{value:101,name:"待支付"},{value:102,name:"支付中"},{value:103,name:"待使用(已支付)"},{value:105,name:"退款中(原因：过期)"},{value:106,name:"已退款(原因：过期)"},{value:107,name:"退款中(原因：申请退款)"},{value:108,name:"已退款(原因：申请退款)"}]},map:{states:{1:"待使用",2:"已使用",4:"已过期",101:"待支付",102:"支付中",103:"待使用(已支付)",105:"退款中(原因：过期)",106:"已退款(原因：过期)",107:"退款中(原因：申请退款)",108:"已退款(原因：申请退款)"},stateTag:{1:"",2:"success",4:"warning",101:"info",102:"info",103:"info",105:"danger",106:"danger",107:"warning",108:"warning"}},pickerOptions:{disabledDate:function(e){return e.getTime()>=Date.now()-864e5}},loading2:!1}},created:function(){this.getOrders(),this.allTotal()},activated:function(){this.getOrders({page:this.page.currentPage})},methods:{resetSearchForm:function(){this.$refs.searchFormRef.resetFields(),this.isSearch=!1,this.getOrders(),this.allTotal()},searchOrders:function(){if(""==this.searchForm.startTime&&(this.searchForm.startTime=null),""==this.searchForm.endTime&&(this.searchForm.endTime=null),this.searchForm.startTime&&this.searchForm.endTime){var e=new Date(Date.parse(this.searchForm.startTime.replace(/-/g,"/"))),t=new Date(Date.parse(this.searchForm.endTime.replace(/-/g,"/")));if(e.getTime()>t.getTime())return void this.$message({message:"日期范围不正确",type:"warning"})}this.isSearch=null!=this.searchForm.startTime||null!=this.searchForm.endTime,this.getOrders(),this.allTotal()},changePage:function(e){var t={page:e};this.getOrders(t)},getOrders:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{page:1,size:10};this.isSearch&&(t.startTime=this.searchForm.startTime,t.endTime=this.searchForm.endTime),null==t.size&&(t.size=10),null==t.page&&(t.page=1),this.$axios.get("/appletordersummary/list",{params:t}).then(function(t){0==t.data.code?(console.log(t.data.page.list),e.orderList=t.data.page.list,e.page={pageCount:t.data.page.totalPage,currentPage:t.data.page.currPage,pageSize:t.data.page.pageSize,total:t.data.page.totalCount}):e.$message({message:t.data.msg,type:"error"})})},exportExcel:function(){var e=this,t={page:1,size:99999999};t.startTime=this.searchForm.startTime,t.endTime=this.searchForm.endTime,this.$axios.get("/appletordersummary/list",{params:t}).then(function(t){0==t.data.code?e._exportExcel(t.data.page.list):e.$message({message:t.data.msg,type:"error"})})},allTotal:function(){var e=this;this.loading2=!1;var t={page:1,size:99999999};t.startTime=this.searchForm.startTime,t.endTime=this.searchForm.endTime,this.$axios.get("/appletordersummary/list",{params:t}).then(function(t){if(0==t.data.code){var a=0,r=0,n=0,o=0,l=0,s=0,i=0,c=0;t.data.page.list.forEach(function(e){a+=e.payPrice,r+=e.refundPrice,o+=e.payPoundage-e.refundPoundage,s+=e.usePrice,i+=e.usePrice-e.usePoundage}),l=(n=a-r)-o,c=t.data.page.list[0]?t.data.page.list[0].unearnedRevenue:"",e.data_total=[{title:"",total_payPrice:a.toFixed(2),total_refundPrice:r.toFixed(2),toatl_netPayment:n.toFixed(2),total_poundage:o.toFixed(2),total_remittance:l.toFixed(2),total_usePrice:s.toFixed(2),total_useFee:i.toFixed(2),total_unearnedRevenue:c.toFixed(2)}],console.log(e.data_total)}else e.$message({message:t.data.msg,type:"error"})})},_exportExcel:function(e){this.loading2=!1;var t=0,a=0,r=0,o=0,s=0,i=0,c=0,u=0;e.forEach(function(e){t+=e.payPrice,a+=e.refundPrice,o+=e.payPoundage-e.refundPoundage,i+=e.usePrice,c+=e.usePrice-e.usePoundage}),s=(r=t-a)-o,u=e[0].unearnedRevenue;var d=[["",t.toFixed(2),a.toFixed(2),r.toFixed(2),o.toFixed(2),s.toFixed(2),i.toFixed(2),c.toFixed(2),u.toFixed(2)]],p=e.map(function(e){return[e.summaryDate.substring(0,10),e.payPrice.toFixed(2),e.refundPrice.toFixed(2),(e.payPrice-e.refundPrice).toFixed(2),(e.payPoundage-e.refundPoundage).toFixed(2),(e.payPrice-e.refundPrice-(e.payPoundage-e.refundPoundage)).toFixed(2),e.usePrice.toFixed(2),(e.usePrice-e.usePoundage).toFixed(2),e.unearnedRevenue.toFixed(2)]}),m=[["总计","总交易金额","总退款金额","总支付净额","总手续费","总划账金额","总当日核销","总当日核销(扣除手续费)","预收账款"]].concat(d.concat([[],[],["交易时间","交易金额","退款金额","支付净额","手续费","划账金额","当日核销","当日核销(扣除手续费)","预收账款"]].concat(p))),g=n.a.utils.aoa_to_sheet(m);g["!cols"]=[{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:140},{wpx:100}],g[n.a.utils.encode_cell({c:1,r:1})].t="n",g[n.a.utils.encode_cell({c:2,r:1})].t="n",g[n.a.utils.encode_cell({c:3,r:1})].t="n",g[n.a.utils.encode_cell({c:4,r:1})].t="n",g[n.a.utils.encode_cell({c:5,r:1})].t="n",g[n.a.utils.encode_cell({c:6,r:1})].t="n",g[n.a.utils.encode_cell({c:7,r:1})].t="n",g[n.a.utils.encode_cell({c:8,r:1})].t="n";for(var _=0;_<e.length;_++)g[n.a.utils.encode_cell({c:0,r:_+5})].t="d",g[n.a.utils.encode_cell({c:1,r:_+5})].t="n",g[n.a.utils.encode_cell({c:2,r:_+5})].t="n",g[n.a.utils.encode_cell({c:3,r:_+5})].t="n",g[n.a.utils.encode_cell({c:4,r:_+5})].t="n",g[n.a.utils.encode_cell({c:5,r:_+5})].t="n",g[n.a.utils.encode_cell({c:6,r:_+5})].t="n",g[n.a.utils.encode_cell({c:7,r:_+5})].t="n",g[n.a.utils.encode_cell({c:8,r:_+5})].t="n";var f=n.a.utils.book_new();n.a.utils.book_append_sheet(f,g),n.a.writeFile(f,"核帐-总帐-"+l()(new Date).format("YYYYMMDD")+".xlsx")}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading2,expression:"loading2"}],attrs:{"element-loading-text":"下载中,请稍等...","element-loading-background":"rgba(245, 245, 245, 0.5)"}},[a("el-form",{ref:"searchFormRef",attrs:{inline:"",model:e.searchForm}},[a("el-form-item",{attrs:{label:"交易开始时间",prop:"startTime"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{clearable:"","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.searchForm.startTime,callback:function(t){e.$set(e.searchForm,"startTime",t)},expression:"searchForm.startTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"交易结束时间",prop:"endTime"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{clearable:"","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.searchForm.endTime,callback:function(t){e.$set(e.searchForm,"endTime",t)},expression:"searchForm.endTime"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchOrders}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:e.resetSearchForm}},[e._v("重置")]),e._v(" "),a("el-button",{on:{click:e.exportExcel}},[e._v("导出Excel")])],1)],1),e._v(" "),a("el-table",{attrs:{stripe:"",data:e.data_total}},[a("el-table-column",{attrs:{label:"总计"}}),e._v(" "),a("el-table-column",{attrs:{label:"总交易金额",prop:"total_payPrice"}}),e._v(" "),a("el-table-column",{attrs:{label:"总退款金额",prop:"total_refundPrice"}}),e._v(" "),a("el-table-column",{attrs:{label:"总支付净额",prop:"toatl_netPayment"}}),e._v(" "),a("el-table-column",{attrs:{label:"总手续费",prop:"total_poundage"}}),e._v(" "),a("el-table-column",{attrs:{label:"总划账金额",prop:"total_remittance"}}),e._v(" "),a("el-table-column",{attrs:{label:"总当日核销",prop:"total_usePrice"}}),e._v(" "),a("el-table-column",{attrs:{label:"总当日核销(扣除手续费)",prop:"total_useFee"}}),e._v(" "),a("el-table-column",{attrs:{label:"总预收账款",prop:"total_unearnedRevenue"}})],1),e._v(" "),a("el-table",{staticStyle:{"margin-top":"30px"},attrs:{stripe:"",data:e.orderList}},[a("el-table-column",{attrs:{label:"交易时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.summaryDate.substring(0,10)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"交易金额",prop:"payPrice"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.payPrice.toFixed(2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"退款金额",prop:"refundPrice"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.refundPrice.toFixed(2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"支付净额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.payPrice-t.row.refundPrice).toFixed(2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"手续费"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.payPoundage-t.row.refundPoundage).toFixed(2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"划账金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.payPrice-t.row.refundPrice-(t.row.payPoundage-t.row.refundPoundage)).toFixed(2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"当日核销",prop:"usePrice"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.usePrice.toFixed(2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"当日核销(扣除手续费)"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.usePrice-t.row.usePoundage).toFixed(2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"预收账款",prop:"unearnedRevenue"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.unearnedRevenue.toFixed(2)))])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination-div"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-count":e.page.pageCount,currentPage:e.page.currentPage,pageSize:e.page.pageSize,total:e.page.total},on:{"current-change":e.changePage}})],1)],1)},staticRenderFns:[]};var c=a("VU/8")(s,i,!1,function(e){a("iFZ4")},"data-v-831f8a64",null);t.default=c.exports},iFZ4:function(e,t){}});