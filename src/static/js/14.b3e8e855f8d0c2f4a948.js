webpackJsonp([14],{c4ej:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("mSl6"),n={name:"hexiao",data:function(){return{token:null,result:[],showConfirmDialog:!1,confirmForm:{orderId:null,token:null,storeId:null,needStore:!1,stores:[],rule:{storeId:{required:!0,message:"请选择核销门店"}}},map:{stateTag:o.b,states:o.a}}},methods:{search:function(){var e=this.token;console.log(e),e&&null!=e.match("[0-9]+")?this._search(e):this.$message({message:"请输入正确的券号",type:"warning"})},_search:function(e){var t=this,r={token:e};this.$axios.get("/seller/search",{params:r}).then(function(e){var r=e.data;0==r.code?t.result=r.order:t.$message({message:r.msg,type:"warning"})})},tryVerificate:function(e){var t=this,r={token:e.token,orderId:e.orderId};this.$axios.get("/seller/verificate",{params:r}).then(function(r){0==r.data.code?(t.confirmForm.orderId=e.orderId,t.confirmForm.token=e.token,t.showConfirmDialog=!0,r.data.stores&&r.data.stores.length>0?(t.confirmForm.needStore=!0,t.confirmForm.stores=r.data.stores.map(function(e){return{id:e.id,name:e.name}})):(t.confirmForm.needStore=!1,t.confirmForm.stores=[])):t.$message({type:"warning",message:r.data.msg})})},resetConfirmForm:function(){this.confirmForm.orderId=null,this.confirmForm.storeId=null,this.confirmForm.needStore=!1,this.confirmForm.stores=[]},confirm:function(){var e=this;this.confirmForm.needStore?this.$refs.confirmFormRef.validate().then(function(){e._confirm()}):this._confirm()},_confirm:function(){var e=this,t={orderId:this.confirmForm.orderId};this.confirmForm.needStore&&(t.storeId=this.confirmForm.storeId),this.$axios.get("/seller/confirm",{params:t}).then(function(t){0==t.data.code?(e.$message({type:"success",message:"核销成功"}),e.result.map(function(t){return t.orderId==e.confirmForm.orderId&&(t.state=2,t.useTime=(new Date).toLocaleString()),t}),e.showConfirmDialog=!1):e.$message({type:"warning",message:t.data.msg})})}}},s={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{attrs:{inline:""}},[r("el-form-item",[r("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入券号"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.search(t):null}},model:{value:e.token,callback:function(t){e.token="string"==typeof t?t.trim():t},expression:"token"}},[r("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("券号")]),e._v(" "),r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1)],1),e._v(" "),r("el-table",{staticStyle:{border:"1px solid #eee"},attrs:{data:e.result,stripe:"",size:"medium"}},[r("el-table-column",{attrs:{width:"40px"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.state||103==t.row.state?r("el-button",{attrs:{type:"primary"},on:{click:function(r){e.tryVerificate(t.row)}}},[e._v("核销")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"券号",prop:"token",width:"100px"}}),e._v(" "),r("el-table-column",{attrs:{label:"名称",prop:"couponName"}}),e._v(" "),r("el-table-column",{attrs:{label:"会员号",prop:"vipCode"}}),e._v(" "),r("el-table-column",{attrs:{label:"有效日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.usageStartTime+" ~ "+t.row.usageEndTime))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"支付时间",prop:"payTime"}}),e._v(" "),r("el-table-column",{attrs:{label:"使用时间",prop:"useTime"}}),e._v(" "),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{type:e.map.stateTag[t.row.state]}},[e._v(e._s(e.map.states[t.row.state]))])]}}])})],1),e._v(" "),r("el-dialog",{attrs:{visible:e.showConfirmDialog,width:"350px",title:"确认核销"},on:{"update:visible":function(t){e.showConfirmDialog=t},close:e.resetConfirmForm}},[r("el-form",{ref:"confirmFormRef",attrs:{"label-width":"80px",model:e.confirmForm,rule:e.confirmForm.rule}},[r("el-form-item",{attrs:{prop:"token",label:"券号"}},[r("el-input",{staticStyle:{width:"200px"},attrs:{readonly:""},model:{value:e.confirmForm.token,callback:function(t){e.$set(e.confirmForm,"token",t)},expression:"confirmForm.token"}})],1),e._v(" "),e.confirmForm.needStore?r("el-form-item",{attrs:{prop:"storeId",label:"核销门店"}},[r("el-select",{model:{value:e.confirmForm.storeId,callback:function(t){e.$set(e.confirmForm,"storeId",t)},expression:"confirmForm.storeId"}},e._l(e.confirmForm.stores,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1):e._e()],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showConfirmDialog=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]},a=r("VU/8")(n,s,!1,null,null,null);t.default=a.exports},mSl6:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return n});var o={0:"全部",1:"待使用",2:"已使用",4:"已过期",101:"待支付",102:"支付中",103:"待使用(已支付)",105:"退款中(原因：过期)",106:"已退款(原因：过期)",107:"退款中(原因：申请退款)",108:"已退款(原因：申请退款)"},n={1:"",2:"success",4:"warning",101:"info",102:"info",103:"info",105:"danger",106:"danger",107:"warning",108:"warning"}}});